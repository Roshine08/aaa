<!doctype html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Roshine — Authenticator</title>
  <link rel="icon" href="/assets/logo.png" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Titillium+Web:wght@400;600;700&display=swap">
  <style>
    :root{
      --bg:#05060b;
      --text:#e6f0ff;
      --muted:#7c8aaa;
      --border:rgba(255,255,255,.10);
    }
    html,body{height:100%}
    body{
      margin:0;
      font-family:"Titillium Web",system-ui,-apple-system,Segoe UI,Roboto,Arial;
      color:var(--text);
      background: radial-gradient(circle at 50% -10%, #161b27 0%, #05060b 65%, #000 100%);
    }

    body::before{
      content:"";
      position:fixed; inset:0; pointer-events:none;
      background:
        radial-gradient(800px 400px at 20% 10%, rgba(255,255,255,.08), transparent 60%),
        radial-gradient(700px 350px at 80% 20%, rgba(255,255,255,.06), transparent 60%),
        linear-gradient(rgba(255,255,255,.030) 1px, transparent 1px),
        linear-gradient(90deg, rgba(255,255,255,.030) 1px, transparent 1px);
      background-size:auto,auto,56px 56px,56px 56px;
      opacity:.40;
      mix-blend-mode:screen;
    }
    body::after{
      content:"";
      position:fixed; inset:0; pointer-events:none;
      background-image:repeating-linear-gradient(to bottom, rgba(255,255,255,.03), rgba(255,255,255,.03) 1px, transparent 1px, transparent 9px);
      opacity:.06;
    }

    .wrap{
      width:min(1040px, 94vw);
      margin:0 auto;
      padding:18px 0 56px;
      position:relative;
      z-index:1;
    }

    .topbar{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:16px;
      margin-bottom:22px;
    }
    .brand{
      display:flex; align-items:center; gap:12px; min-width:0;
      padding:10px 14px;
      border-radius:999px;
      border:1px solid var(--border);
      background:rgba(0,0,0,.20);
      box-shadow:0 14px 34px rgba(0,0,0,.38), 0 0 0 1px rgba(255,255,255,.06) inset;
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
    }
    .brand img{width:28px;height:28px;border-radius:12px;}
    .brand .name{font-weight:900; letter-spacing:.06em; white-space:nowrap; font-size:13px; text-transform:uppercase;}
    .brand .sub{font-size:11px; color:var(--muted); margin-top:2px; line-height:1.25; max-width:64ch;}

    .top-controls{display:flex; align-items:center; gap:10px; flex-wrap:wrap;}

    .pill{
      height:40px;
      padding:0 14px;
      border-radius:999px;
      border:1px solid var(--border);
      background:rgba(0,0,0,.20);
      color:var(--text);
      font-size:13px;
      font-weight:800;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      cursor:pointer;
      box-shadow:0 14px 34px rgba(0,0,0,.38), 0 0 0 1px rgba(255,255,255,.06) inset;
      text-decoration:none;
      user-select:none;
      position:relative;
      overflow:hidden;
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      transition:transform .15s ease, background .15s ease, box-shadow .15s ease;
    }
    .pill:hover{
      transform:translateY(-1px);
      background:rgba(255,255,255,.06);
      box-shadow:0 14px 34px rgba(0,0,0,.38), 0 0 0 1px rgba(255,255,255,.10) inset;
    }
    .pill::after{
      content:"";
      position:absolute;
      inset:-40% -60%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,.14), transparent);
      transform: translateX(-30%) rotate(12deg);
      opacity:0;
      transition: opacity .18s ease, transform .35s ease;
      pointer-events:none;
    }
    .pill:hover::after{opacity:.55; transform: translateX(30%) rotate(12deg);}

    .lang-select{
      appearance:none; -webkit-appearance:none; -moz-appearance:none;
      border:none; background:transparent; padding:0 18px; text-align:center; cursor:pointer;
    }
    .lang-select option{background:#050b16; color:#e8eefc;}

    .tool-pill{gap:10px; cursor:default;}
    .auth-badge{width:18px; height:18px; opacity:.9; display:block;}

    .panel{
      width:min(780px, 94vw);
      margin:0 auto;
      padding:28px 22px 22px;
      border-radius:26px;
      background:rgba(0,0,0,.20);
      border:1px solid var(--border);
      box-shadow:0 22px 60px rgba(0,0,0,.55), 0 0 0 1px rgba(255,255,255,.06) inset;
      backdrop-filter: blur(14px);
      -webkit-backdrop-filter: blur(14px);
    }

    .panel h1{
      margin:0 0 6px;
      font-size:22px;
      letter-spacing:.06em;
      text-transform:uppercase;
      text-align:center;
      font-weight:900;
    }
    .panel p{
      margin:0 auto 18px;
      max-width:70ch;
      text-align:center;
      color:var(--muted);
      line-height:1.6;
      font-size:13px;
    }

    .field{margin-top:14px;}
    .label{font-size:12px; color:rgba(230,240,255,.72); font-weight:800; letter-spacing:.04em;}
    input{
      width:100%;
      height:48px;
      margin-top:10px;
      padding:0 14px;
      border-radius:16px;
      border:1px solid var(--border);
      background:rgba(0,0,0,.24);
      color:var(--text);
      outline:none;
      font-size:14px;
      box-shadow:0 0 0 1px rgba(255,255,255,.06) inset;
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
    }
    input:focus{
      border-color:rgba(255,255,255,.18);
      box-shadow:0 0 0 1px rgba(255,255,255,.12) inset, 0 14px 34px rgba(0,0,0,.38);
    }

    .codebox{
      margin-top:16px;
      border-radius:18px;
      border:1px solid var(--border);
      background:rgba(0,0,0,.18);
      padding:16px 14px;
      text-align:center;
      box-shadow:0 0 0 1px rgba(255,255,255,.06) inset;
      position:relative;
      overflow:hidden;
    }
    .code{
      font-size:40px;
      letter-spacing:.12em;
      font-weight:900;
      font-variant-numeric: tabular-nums;
    }
    .status{margin-top:8px; color:rgba(230,240,255,.62); font-size:12px; min-height:16px;}
    .progress-wrap{margin-top:12px; height:6px; border-radius:999px; background:rgba(255,255,255,.08); overflow:hidden;}
    .progress{height:100%; width:0%; background:rgba(255,255,255,.22);}

    .actions{
      display:flex;
      justify-content:center;
      gap:12px;
      margin-top:16px;
      flex-wrap:wrap;
    }
    .btn{
      height:44px;
      padding:0 16px;
      border-radius:999px;
      border:1px solid var(--border);
      background:rgba(0,0,0,.20);
      color:var(--text);
      font-weight:900;
      cursor:pointer;
      box-shadow:0 14px 34px rgba(0,0,0,.38), 0 0 0 1px rgba(255,255,255,.06) inset;
      position:relative;
      overflow:hidden;
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      transition:transform .15s ease, background .15s ease, box-shadow .15s ease;
      min-width:200px;
    }
    .btn:hover{
      transform:translateY(-1px);
      background:rgba(255,255,255,.06);
      box-shadow:0 14px 34px rgba(0,0,0,.38), 0 0 0 1px rgba(255,255,255,.10) inset;
    }
    .btn::after{
      content:"";
      position:absolute;
      inset:-40% -60%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,.14), transparent);
      transform: translateX(-30%) rotate(12deg);
      opacity:0;
      transition: opacity .18s ease, transform .35s ease;
      pointer-events:none;
    }
    .btn:hover::after{opacity:.55; transform: translateX(30%) rotate(12deg);}

    .tips{
      margin-top:16px;
      color:var(--muted);
      font-size:12px;
      line-height:1.6;
      text-align:center;
    }

    .footer{
      margin-top:22px;
      text-align:center;
      color:rgba(230,240,255,.55);
      font-size:12px;
      opacity:.9;
      user-select:none;
      line-height:1.6;
    }

    @media (max-width:760px){
      .brand .sub{display:none;}
      .pill{height:38px;}
      .panel{padding:24px 16px 18px;}
      .code{font-size:34px;}
      .btn{min-width:0; width:100%;}
      .actions{gap:10px;}
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="topbar">
      <div class="brand">
        <img src="/assets/logo.png" alt="Roshine Logo" />
        <div>
          <div class="name">ROSHINE ACCOUNT STORE.</div>
          <div class="sub" id="subText">Overwatch Account Store • Listings via Google Sheet • Order via Discord</div>
        </div>
      </div>

      <div class="top-controls">
        <select id="langSelect" class="pill lang-select" title="Language">
          <option value="en">EN</option>
          <option value="fr">FR</option>
          <option value="de">DE</option>
          <option value="ar">العربية</option>
          <option value="zh">中文</option>
        </select>

        <a class="pill" href="/" id="homeLink" title="Home"><span id="homeText">Home</span></a>

        <div class="pill tool-pill" aria-label="Authenticator">
          <span id="toolText">Authenticator</span>
          <img class="auth-badge" src="logo.png" alt="Auth" />
        </div>
      </div>
    </div>

    <div class="panel">
      <h1 id="pageTitle">Battle.net Authenticator</h1>
      <p id="pageDesc">Generate a time-based verification code from your Private Key.</p>

      <div class="field">
        <div class="label" id="secretLabel">Paste your Private Key</div>
        <input id="keyInput" autocomplete="off" spellcheck="false" inputmode="text" placeholder="Private Key" />
      </div>

      <div class="codebox">
        <div class="code" id="codeText">--------</div>
        <div class="status" id="statusText"></div>
        <div class="progress-wrap"><div class="progress" id="progressBar"></div></div>
      </div>

      <div class="actions">
        <button class="btn" id="copyBtn"><span id="copyBtnText">Copy Code</span></button>
        <button class="btn" id="clearBtn"><span id="clearBtnText">Clear Key</span></button>
      </div>

      <div class="tips">
        <div id="tip1">Runs locally in your browser. Nothing is uploaded.</div>
        <div id="tip2">Paste the generated code into the Battle.net app to verify.</div>
      </div>
    </div>

    <div class="footer" id="footer"></div>
  </div>

  <script>
    const LANG_KEY = "locale-choice";
    const i18n = {
      en:{
        sub:"Overwatch Account Store • Listings via Google Sheet • Order via Discord",
        home:"Home",
        tool:"Authenticator",
        title:"Battle.net Authenticator",
        secretLabel:"Paste your Private Key",
        placeholder:"Private Key",
        copy:"Copy Code",
        clear:"Clear Key",
        copied:"Copied",
        copyBlocked:"Copy blocked",
        enterKeyError:"Enter your Private Key",
        invalidKey:"Invalid Private Key",
        tip1:"Runs locally in your browser. Nothing is uploaded.",
        tip2:"Paste the generated code into the Battle.net app to verify.",
        footer:"© 2021–2026 Roshine Account Store. All rights reserved • your best account supplier."
      },
      fr:{
        sub:"Boutique de comptes Overwatch • Liste via Google Sheet • Commande via Discord",
        home:"Accueil",
        tool:"Authenticator",
        title:"Authenticator Battle.net",
        secretLabel:"Collez votre Private Key",
        placeholder:"Private Key",
        copy:"Copier le code",
        clear:"Effacer",
        copied:"Copié",
        copyBlocked:"Copie bloquée",
        enterKeyError:"Saisissez votre Private Key",
        invalidKey:"Private Key invalide",
        tip1:"Fonctionne localement dans votre navigateur. Rien n’est envoyé.",
        tip2:"Collez le code dans l’app Battle.net pour valider.",
        footer:"© 2021–2026 Roshine Account Store. Tous droits réservés • votre meilleur fournisseur de comptes."
      },
      de:{
        sub:"Overwatch Account Store • Liste via Google Sheet • Bestellung über Discord",
        home:"Start",
        tool:"Authenticator",
        title:"Battle.net Authenticator",
        secretLabel:"Private Key einfügen",
        placeholder:"Private Key",
        copy:"Code kopieren",
        clear:"Löschen",
        copied:"Kopiert",
        copyBlocked:"Kopieren blockiert",
        enterKeyError:"Private Key eingeben",
        invalidKey:"Ungültiger Private Key",
        tip1:"Läuft lokal im Browser. Es wird nichts hochgeladen.",
        tip2:"Code in die Battle.net-App zur Verifizierung einfügen.",
        footer:"© 2021–2026 Roshine Account Store. Alle Rechte vorbehalten • dein bester Account-Lieferant."
      },
      ar:{
        sub:"متجر حسابات Overwatch • القائمة عبر Google Sheet • الطلب عبر Discord",
        home:"الرئيسية",
        tool:"Authenticator",
        title:"Battle.net Authenticator",
        secretLabel:"الصق Private Key",
        placeholder:"Private Key",
        copy:"نسخ الرمز",
        clear:"مسح",
        copied:"تم النسخ",
        copyBlocked:"تعذر النسخ",
        enterKeyError:"أدخل Private Key",
        invalidKey:"Private Key غير صالح",
        tip1:"يعمل محليًا في المتصفح. لا يتم رفع أي شيء.",
        tip2:"الصق الرمز في تطبيق Battle.net للتحقق.",
        footer:"© 2021–2026 Roshine Account Store. جميع الحقوق محفوظة • أفضل مورد للحسابات."
      },
      zh:{
        sub:"Overwatch Account Store • Google Sheet 展示库存 • Discord 联系下单",
        home:"主页",
        tool:"Authenticator",
        title:"Battle.net 安全令",
        secretLabel:"粘贴你的 Private Key",
        placeholder:"Private Key",
        copy:"复制验证码",
        clear:"清除",
        copied:"已复制",
        copyBlocked:"复制受限",
        enterKeyError:"请输入 Private Key",
        invalidKey:"Private Key 无效",
        tip1:"仅在浏览器本地运行，不会上传任何内容。",
        tip2:"把验证码复制到 Battle.net App 的验证界面。",
        footer:"© 2021–2026 Roshine Account Store. 保留所有权利 • 你值得信赖的账号供应商。"
      }
    };

    function detectLang(){
      const saved = localStorage.getItem(LANG_KEY);
      if (saved && i18n[saved]) return saved;
      const nav = (navigator.language || "en").toLowerCase();
      if (nav.startsWith("zh")) return "zh";
      if (nav.startsWith("fr")) return "fr";
      if (nav.startsWith("de")) return "de";
      if (nav.startsWith("ar")) return "ar";
      return "en";
    }

    function applyLang(lang){
      if (!i18n[lang]) lang = "en";
      document.documentElement.lang = lang;
      document.documentElement.dir = (lang === "ar" ? "rtl" : "ltr");

      const t = i18n[lang];
      document.getElementById("subText").textContent = t.sub;
      document.getElementById("homeText").textContent = t.home;
      document.getElementById("toolText").textContent = t.tool;

      document.getElementById("pageTitle").textContent = t.title;
      document.getElementById("secretLabel").textContent = t.secretLabel;
      document.getElementById("keyInput").placeholder = t.placeholder;

      document.getElementById("copyBtnText").textContent = t.copy;
      document.getElementById("clearBtnText").textContent = t.clear;

      document.getElementById("tip1").textContent = t.tip1;
      document.getElementById("tip2").textContent = t.tip2;

      document.getElementById("footer").textContent = t.footer;

      const sel = document.getElementById("langSelect");
      if (sel) sel.value = lang;
    }

    applyLang(detectLang());
    document.getElementById("langSelect").addEventListener("change", e => {
      const lang = e.target.value;
      applyLang(lang);
      localStorage.setItem(LANG_KEY, lang);
    });

    // ====== TOTP (保持你原始页面逻辑/算法，不改核心功能) ======
    const DIGITS = 8;
    const PERIOD = 30;

    function getKeyFromURL() {
      const url = new URL(window.location.href);
      const k = url.searchParams.get("key");
      if (!k) return "";
      return k;
    }

    function normalizeHex(input) {
      return (input || "").trim().replace(/\s+/g, "").replace(/^0x/i, "");
    }

    function hexToBytes(hex) {
      const clean = normalizeHex(hex);
      if (!clean) return new Uint8Array();
      if (!/^[0-9a-fA-F]+$/.test(clean) || clean.length % 2 !== 0) {
        throw new Error("Invalid hex");
      }
      const out = new Uint8Array(clean.length / 2);
      for (let i = 0; i < out.length; i++) {
        out[i] = parseInt(clean.substr(i * 2, 2), 16);
      }
      return out;
    }

    function counterBytes(counter) {
      const buf = new ArrayBuffer(8);
      const view = new DataView(buf);
      const hi = Math.floor(counter / 0x100000000);
      const lo = counter >>> 0;
      view.setUint32(0, hi);
      view.setUint32(4, lo);
      return new Uint8Array(buf);
    }

    async function hmacSha1(keyBytes, msgBytes) {
      const key = await crypto.subtle.importKey(
        "raw",
        keyBytes,
        { name: "HMAC", hash: "SHA-1" },
        false,
        ["sign"]
      );
      const sig = await crypto.subtle.sign("HMAC", key, msgBytes);
      return new Uint8Array(sig);
    }

    function truncate(hmacBytes) {
      const offset = hmacBytes[hmacBytes.length - 1] & 0x0f;
      const p =
        ((hmacBytes[offset] & 0x7f) << 24) |
        ((hmacBytes[offset + 1] & 0xff) << 16) |
        ((hmacBytes[offset + 2] & 0xff) << 8) |
        (hmacBytes[offset + 3] & 0xff);
      return p >>> 0;
    }

    function fmt(num) {
      let s = String(num % (10 ** DIGITS));
      while (s.length < DIGITS) s = "0" + s;
      return s;
    }

    async function gen() {
      const t = Math.floor(Date.now() / 1000);
      const counter = Math.floor(t / PERIOD);
      const keyHex = document.getElementById("keyInput").value;
      const lang = document.documentElement.lang || "en";
      const tr = i18n[lang] || i18n.en;

      let keyBytes;
      try {
        keyBytes = hexToBytes(keyHex);
      } catch {
        document.getElementById("statusText").textContent = tr.invalidKey;
        document.getElementById("codeText").textContent = "--------";
        return;
      }

      if (!keyBytes.length) {
        document.getElementById("statusText").textContent = "";
        document.getElementById("codeText").textContent = "--------";
        return;
      }

      const msg = counterBytes(counter);
      const hmac = await hmacSha1(keyBytes, msg);
      const bin = truncate(hmac);
      document.getElementById("codeText").textContent = fmt(bin);
      document.getElementById("statusText").textContent = "";
    }

    function tick() {
      const t = Math.floor(Date.now() / 1000);
      const step = t % PERIOD;
      const pct = Math.max(0, Math.min(100, (step / PERIOD) * 100));
      document.getElementById("progressBar").style.width = pct + "%";
    }

    // events
    const prefill = getKeyFromURL();
    if (prefill) document.getElementById("keyInput").value = prefill;

    document.getElementById("keyInput").addEventListener("input", () => gen());
    document.getElementById("clearBtn").addEventListener("click", () => {
      document.getElementById("keyInput").value = "";
      document.getElementById("codeText").textContent = "--------";
      document.getElementById("statusText").textContent = "";
      gen();
    });

    document.getElementById("copyBtn").addEventListener("click", async () => {
      const code = document.getElementById("codeText").textContent || "";
      const lang = document.documentElement.lang || "en";
      const tr = i18n[lang] || i18n.en;

      if (!code || code.includes("-")) {
        document.getElementById("statusText").textContent = tr.enterKeyError;
        return;
      }

      try {
        await navigator.clipboard.writeText(code);
        document.getElementById("statusText").textContent = tr.copied;
        setTimeout(() => {
          if (document.getElementById("statusText").textContent === tr.copied) {
            document.getElementById("statusText").textContent = "";
          }
        }, 900);
      } catch {
        document.getElementById("statusText").textContent = tr.copyBlocked;
      }
    });

    // start
    gen();
    tick();
    setInterval(() => { tick(); gen(); }, 1000);
  </script>
</body>
</html>
