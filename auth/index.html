<!doctype html>
<html lang="en" data-theme="dark">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Roshine Account Store ‚Äî Authenticator</title>
<link rel="icon" href="/assets/logo.png" />

<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Titillium+Web:wght@400;600;700;800;900&display=swap">

<style>
:root{
  --bg:#05060b;
  --text:#e6f0ff;
  --muted:#7c8aaa;
  --glass: rgba(12,16,24,.62);
  --stroke: rgba(120,170,255,.16);
  --accent:#29b6ff;
  --accent2:#7a5cff;
  --shadow: 0 24px 70px rgba(0,0,0,.62);
  --radius: 22px;
}

*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;
  font-family:"Titillium Web",system-ui,-apple-system,Segoe UI,Roboto,Arial;
  color:var(--text);
  background:#05060b;
  overflow-x:hidden;
}

/* Same cinematic glass background as homepage */
body::before{
  content:"";
  position:fixed; inset:-20%;
  background:
    radial-gradient(1000px 600px at 18% 12%, rgba(41,182,255,.16), transparent 60%),
    radial-gradient(900px 520px at 78% 18%, rgba(122,92,255,.12), transparent 62%),
    radial-gradient(900px 600px at 50% 70%, rgba(41,182,255,.08), transparent 60%),
    linear-gradient(rgba(255,255,255,.035) 1px, transparent 1px),
    linear-gradient(90deg, rgba(255,255,255,.035) 1px, transparent 1px);
  background-size:auto,auto,auto,56px 56px,56px 56px;
  opacity:.55;
  pointer-events:none;
  z-index:0;
}
body::after{
  content:"";
  position:fixed; inset:0;
  background:
    radial-gradient(70% 60% at 50% 40%, rgba(0,0,0,.00), rgba(0,0,0,.72) 65%, rgba(0,0,0,.90) 100%),
    repeating-linear-gradient(
      to bottom,
      rgba(255,255,255,.03),
      rgba(255,255,255,.03) 1px,
      transparent 1px,
      transparent 9px
    );
  opacity:.08;
  pointer-events:none;
  z-index:0;
}

.wrap{
  width:min(1040px, 92vw);
  margin:0 auto;
  padding:18px 0 56px;
  position:relative;
  z-index:1;
}

/* Top bar matches homepage */
.topbar{
  position:sticky;
  top:14px;
  z-index:20;
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:12px;
  padding:10px 12px;
  border-radius:999px;
  background: linear-gradient(180deg, rgba(12,16,24,.66), rgba(12,16,24,.40));
  border:1px solid var(--stroke);
  box-shadow: 0 14px 42px rgba(0,0,0,.55), 0 0 0 1px rgba(255,255,255,.05) inset;
  backdrop-filter: blur(14px);
}

.brand{
  display:flex;
  align-items:center;
  gap:10px;
  min-width:0;
  padding:6px 10px;
  border-radius:999px;
  border:1px solid rgba(255,255,255,.06);
  background: rgba(0,0,0,.18);
}
.brand img{
  width:30px; height:30px;
  border-radius:12px;
  box-shadow: 0 10px 24px rgba(0,0,0,.45);
  flex:0 0 auto;
}
.brand .title{
  font-weight:900;
  letter-spacing:.06em;
  font-size:13px;
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
  text-transform:uppercase;
  opacity:.95;
}

.controls{
  display:flex; align-items:center; gap:10px; flex-wrap:nowrap;
}

.pill{
  height:36px;
  padding:0 14px;
  border-radius:999px;
  border:1px solid rgba(255,255,255,.08);
  background: rgba(0,0,0,.18);
  color:var(--text);
  display:inline-flex;
  align-items:center;
  justify-content:center;
  font-weight:900;
  letter-spacing:.03em;
  text-decoration:none;
  user-select:none;
  cursor:pointer;
  box-shadow: 0 10px 26px rgba(0,0,0,.45);
  backdrop-filter: blur(12px);
  transition: transform .15s ease, box-shadow .15s ease, background .15s ease;
}
.pill:hover{
  transform: translateY(-1px);
  background: rgba(0,0,0,.26);
  box-shadow: 0 14px 34px rgba(0,0,0,.62), 0 0 18px rgba(41,182,255,.12);
}

select.pill{
  appearance:none;
  -webkit-appearance:none;
  -moz-appearance:none;
  padding:0 18px;
}
select.pill option{
  background:#050b16;
  color:#e8eefc;
}

/* Auth label + small logo */
.authTag{
  display:inline-flex;
  align-items:center;
  gap:8px;
  padding:0 12px;
}
.authLogo{
  width:18px; height:18px;
  border-radius:6px;
  opacity:.95;
  box-shadow: 0 8px 18px rgba(0,0,0,.45);
}

/* Main authenticator panel */
.panel{
  margin-top:18px;
  border-radius: calc(var(--radius) + 10px);
  background: linear-gradient(180deg, rgba(12,16,24,.62), rgba(12,16,24,.35));
  border:1px solid var(--stroke);
  box-shadow: var(--shadow);
  position:relative;
  overflow:hidden;
  backdrop-filter: blur(16px);
  padding: clamp(18px, 3vw, 28px);
}
.panel::before{
  content:"";
  position:absolute; inset:0;
  border-radius:inherit;
  padding:1px;
  background: linear-gradient(135deg, rgba(41,182,255,.55), rgba(122,92,255,.30), rgba(41,182,255,.35));
  -webkit-mask: linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0);
  -webkit-mask-composite:xor;
          mask-composite:exclude;
  opacity:.65;
  pointer-events:none;
}

.headRow{
  display:flex;
  align-items:flex-start;
  justify-content:space-between;
  gap:14px;
  margin-bottom:10px;
}
.headRow .h{
  margin:0;
  font-weight:900;
  letter-spacing:.04em;
  font-size:18px;
}
.sub{
  margin:4px 0 0;
  color:rgba(124,138,170,.95);
  font-size:13px;
  line-height:1.55;
  max-width:72ch;
}

.code{
  margin:18px 0 8px;
  text-align:center;
  font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
  font-weight:900;
  letter-spacing:6px;
  font-size: clamp(40px, 7vw, 78px);
}

.hint{
  text-align:center;
  color: rgba(124,138,170,.95);
  font-size:13px;
  margin-bottom:12px;
}

.barwrap{
  height:12px;
  border-radius:999px;
  overflow:hidden;
  background: rgba(255,255,255,.08);
  border:1px solid rgba(255,255,255,.06);
}
.bar{
  height:100%;
  width:0%;
  background: linear-gradient(90deg, rgba(41,182,255,.92), rgba(122,92,255,.72));
  background-size:200% 100%;
  animation:stripe 1.3s linear infinite;
  transition:width .15s linear;
}
@keyframes stripe{
  0%{background-position:0% 0}
  100%{background-position:200% 0}
}

.label{
  margin-top:18px;
  font-size:14px;
  font-weight:800;
  letter-spacing:.02em;
  color: rgba(230,240,255,.92);
}

input{
  width:100%;
  margin-top:10px;
  padding:14px 14px;
  border-radius:16px;
  border:1px solid rgba(120,170,255,.18);
  background: rgba(0,0,0,.18);
  color:var(--text);
  font-family:ui-monospace,monospace;
  outline:none;
  transition: box-shadow .15s ease, border-color .15s ease, background .15s ease;
}
input:focus{
  border-color: rgba(41,182,255,.45);
  box-shadow: 0 0 0 3px rgba(41,182,255,.10);
  background: rgba(0,0,0,.22);
}
input::placeholder{ color: rgba(159,176,200,.70); }

.actions{
  display:flex;
  gap:12px;
  margin-top:16px;
  flex-wrap:wrap;
}
button{
  height:46px;
  padding:0 16px;
  border-radius:16px;
  border:1px solid rgba(120,170,255,.18);
  background: rgba(0,0,0,.18);
  color:var(--text);
  font-weight:900;
  letter-spacing:.02em;
  cursor:pointer;
  display:inline-flex;
  align-items:center;
  justify-content:center;
  gap:10px;
  min-width: 180px;
  backdrop-filter: blur(12px);
  transition: transform .15s ease, box-shadow .15s ease, background .15s ease;
}
button:hover{
  transform: translateY(-1px);
  background: rgba(0,0,0,.24);
  box-shadow: 0 0 20px rgba(41,182,255,.16);
}
button.primary{
  background: linear-gradient(90deg, rgba(41,182,255,.92), rgba(122,92,255,.72));
  border-color: transparent;
  color:#fff;
  box-shadow: 0 16px 40px rgba(41,182,255,.18);
}
button.primary:hover{
  box-shadow: 0 0 26px rgba(41,182,255,.30);
}

.status{
  margin-top:10px;
  min-height:18px;
  text-align:center;
  font-size:12px;
}
.status.ok{ color:#4cd18c; }
.status.err{ color:#ff6b6b; }

.footer{
  margin-top:16px;
  text-align:center;
  color: rgba(124,138,170,.86);
  font-size:12px;
  opacity:.9;
  user-select:none;
}

/* Mobile */
@media (max-width:760px){
  .topbar{ top:10px; padding:10px; }
  .pill{ height:34px; padding:0 12px; }
  .panel{ margin-top:14px; }
  button{ width:100%; min-width:0; }
  .actions{ flex-direction:column; }
}

/* RTL */
html[dir="rtl"] .brand{ flex-direction: row-reverse; }
html[dir="rtl"] .controls{ flex-direction: row-reverse; }
</style>
</head>

<body>
  <div class="wrap">
    <div class="topbar">
      <div class="brand">
        <img src="/assets/logo.png" alt="Roshine Logo" />
        <div class="title">ROSHINE ACCOUNT STORE.</div>
      </div>

      <div class="controls">
        <!-- LANG: EN / FR / DE / AR / ‰∏≠Êñá(ÊúÄÂêé) -->
        <select id="langSelect" class="pill" title="Language">
          <option value="en">EN</option>
          <option value="fr">FR</option>
          <option value="de">DE</option>
          <option value="ar">AR</option>
          <option value="zh">‰∏≠Êñá</option>
        </select>

        <!-- Authenticator tag + auth/logo -->
        <div class="pill authTag" id="authTag" title="Authenticator">
          üîí <span id="authText">Authenticator</span>
          <img class="authLogo" src="./logo.png" alt="auth logo" />
        </div>

        <!-- Home on the RIGHT, emoji only -->
        <a class="pill" href="/" id="homeBtn" title="Home">üè†</a>
      </div>
    </div>

    <div class="panel">
      <div class="headRow">
        <div>
          <h2 class="h" id="titleText">Authenticator</h2>
          <p class="sub" id="subtitleText">
            Paste your Private Key. Codes are generated locally in your browser.
          </p>
        </div>
      </div>

      <div class="code" id="code">--------</div>
      <div class="hint" id="remain"></div>
      <div class="barwrap"><div class="bar" id="bar"></div></div>

      <div class="label" id="secretLabel">Private Key</div>
      <input id="secret" placeholder="Private Key" autocomplete="off" spellcheck="false" />

      <div class="actions">
        <button class="primary" id="copy">üìã <span id="copyText">Copy Code</span></button>
        <button id="clear">üßπ <span id="clearText">Clear</span></button>
      </div>

      <div class="status" id="status"></div>
      <div class="footer" id="footer"></div>
    </div>
  </div>

<script>
  // ===== Settings =====
  const DIGITS = 8;
  const PERIOD = 30;
  const LANG_KEY  = "locale-choice";
  const $ = id => document.getElementById(id);

  // ===== i18n (same language set as homepage) =====
  const i18n = {
    en: {
      authTag: "Authenticator",
      title: "Authenticator",
      subtitle: "Paste your Private Key. Codes are generated locally in your browser.",
      secretLabel: "Private Key",
      placeholder: "Private Key",
      copy: "Copy Code",
      clear: "Clear",
      copied: "Copied",
      copyBlocked: "Copy blocked",
      enterKeyError: "Enter your Private Key",
      invalidKey: "Invalid Private Key",
      footer: "¬© {year} Roshine Account Store. All rights reserved."
    },
    fr: {
      authTag: "Authenticator",
      title: "Authenticator",
      subtitle: "Collez votre cl√© priv√©e. Les codes sont g√©n√©r√©s localement dans votre navigateur.",
      secretLabel: "Cl√© priv√©e",
      placeholder: "Cl√© priv√©e",
      copy: "Copier le code",
      clear: "Effacer",
      copied: "Copi√©",
      copyBlocked: "Copie bloqu√©e",
      enterKeyError: "Entrez votre cl√© priv√©e",
      invalidKey: "Cl√© priv√©e invalide",
      footer: "¬© {year} Roshine Account Store. Tous droits r√©serv√©s."
    },
    de: {
      authTag: "Authenticator",
      title: "Authenticator",
      subtitle: "F√ºge deinen Private Key ein. Codes werden lokal im Browser erzeugt.",
      secretLabel: "Private Key",
      placeholder: "Private Key",
      copy: "Code kopieren",
      clear: "L√∂schen",
      copied: "Kopiert",
      copyBlocked: "Kopieren blockiert",
      enterKeyError: "Bitte Private Key eingeben",
      invalidKey: "Ung√ºltiger Private Key",
      footer: "¬© {year} Roshine Account Store. Alle Rechte vorbehalten."
    },
    ar: {
      authTag: "Authenticator",
      title: "Authenticator",
      subtitle: "ÿßŸÑÿµŸÇ Private Key. Ÿäÿ™ŸÖ ÿ™ŸàŸÑŸäÿØ ÿßŸÑÿ£ŸÉŸàÿßÿØ ŸÖÿ≠ŸÑŸäŸãÿß ÿØÿßÿÆŸÑ ÿßŸÑŸÖÿ™ÿµŸÅÿ≠.",
      secretLabel: "Private Key",
      placeholder: "Private Key",
      copy: "ŸÜÿ≥ÿÆ ÿßŸÑÿ±ŸÖÿ≤",
      clear: "ŸÖÿ≥ÿ≠",
      copied: "ÿ™ŸÖ ÿßŸÑŸÜÿ≥ÿÆ",
      copyBlocked: "ÿ™ŸÖ ŸÖŸÜÿπ ÿßŸÑŸÜÿ≥ÿÆ",
      enterKeyError: "ÿ£ÿØÿÆŸÑ Private Key",
      invalidKey: "Private Key ÿ∫Ÿäÿ± ÿµÿßŸÑÿ≠",
      footer: "¬© {year} Roshine Account Store. ÿ¨ŸÖŸäÿπ ÿßŸÑÿ≠ŸÇŸàŸÇ ŸÖÿ≠ŸÅŸàÿ∏ÿ©."
    },
    zh: {
      authTag: "ÂÆâÂÖ®‰ª§",
      title: "ÂÆâÂÖ®‰ª§",
      subtitle: "Á≤òË¥¥‰Ω†ÁöÑ Private Key„ÄÇÈ™åËØÅÁ†ÅÂú®ÊµèËßàÂô®Êú¨Âú∞ÁîüÊàê„ÄÇ",
      secretLabel: "ÂÆâÂÖ®‰ª§ÁßòÈí•",
      placeholder: "ÂÆâÂÖ®‰ª§ÁßòÈí•",
      copy: "Â§çÂà∂È™åËØÅÁ†Å",
      clear: "Ê∏ÖÁ©∫",
      copied: "Â∑≤Â§çÂà∂",
      copyBlocked: "ÊµèËßàÂô®Á¶ÅÊ≠¢Â§çÂà∂",
      enterKeyError: "ËØ∑ËæìÂÖ•ÂÆâÂÖ®‰ª§ÁßòÈí•",
      invalidKey: "Êó†ÊïàÁöÑÂÆâÂÖ®‰ª§ÁßòÈí•",
      footer: "¬© {year} Roshine Account Store. ‰øùÁïôÊâÄÊúâÊùÉÂà©„ÄÇ"
    }
  };

  function detectLang(){
    const saved = localStorage.getItem(LANG_KEY);
    if (saved && i18n[saved]) return saved;

    const nav = (navigator.language || "en").toLowerCase();
    if (nav.startsWith("fr")) return "fr";
    if (nav.startsWith("de")) return "de";
    if (nav.startsWith("ar")) return "ar";
    if (nav.startsWith("zh")) return "zh";
    return "en";
  }

  let currentLang = "en";
  const t = (key) => (i18n[currentLang] && i18n[currentLang][key]) || i18n.en[key] || key;

  function applyLang(lang){
    if (!i18n[lang]) lang = "en";
    currentLang = lang;

    document.documentElement.lang = lang;
    document.documentElement.dir  = (lang === "ar" ? "rtl" : "ltr");

    $("langSelect").value = lang;

    $("authText").textContent = t("authTag");
    $("titleText").textContent = t("title");
    $("subtitleText").textContent = t("subtitle");

    $("secretLabel").textContent = t("secretLabel");
    $("secret").placeholder = t("placeholder");

    $("copyText").textContent = t("copy");
    $("clearText").textContent = t("clear");

    $("footer").textContent = t("footer").replace("{year}", new Date().getFullYear());
  }

  applyLang(detectLang());

  $("langSelect").addEventListener("change", (e) => {
    const lang = e.target.value;
    localStorage.setItem(LANG_KEY, lang);
    applyLang(lang);
    // also refresh status text if any
    const statusEl = $("status");
    if (statusEl && statusEl.classList.contains("ok")) statusEl.textContent = t("copied");
    if (statusEl && statusEl.classList.contains("err")) {
      // leave as-is; it will be overwritten by next gen()
    }
  });

  // ===== URL key support (?key= or /hex) =====
  function getKeyFromURL(){
    const u = new URL(location.href);
    const paramKey = u.searchParams.get("key");
    if (paramKey && /^[0-9a-fA-F]+$/.test(paramKey)) return paramKey;

    const parts = u.pathname.split("/").filter(Boolean);
    if (parts.length){
      const last = parts[parts.length - 1];
      if (/^[0-9a-fA-F]+$/.test(last)) return last;
    }
    return null;
  }

  // ===== TOTP =====
  function hexToBytes(s){
    s = s.trim().replace(/^0x/i,"").replace(/[^0-9a-f]/ig,"");
    if (!s) throw new Error("ERR_EMPTY_KEY");
    if (s.length % 2) throw new Error("ERR_INVALID_KEY");
    return Uint8Array.from(s.match(/../g).map(x => parseInt(x,16)));
  }
  function counterBytes(c){
    const b = new Uint8Array(8); let x = BigInt(c);
    for (let i = 7; i >= 0; i--){
      b[i] = Number(x & 0xffn);
      x >>= 8n;
    }
    return b;
  }
  async function hmacSha1(key,msg){
    const k = await crypto.subtle.importKey("raw", key, {name:"HMAC", hash:"SHA-1"}, false, ["sign"]);
    return new Uint8Array(await crypto.subtle.sign("HMAC", k, msg));
  }
  function truncate(mac){
    const o = mac[mac.length - 1] & 0x0f;
    return (((mac[o]   & 0x7f) << 24) |
            ((mac[o+1] & 0xff) << 16) |
            ((mac[o+2] & 0xff) << 8)  |
            ( mac[o+3] & 0xff)) >>> 0;
  }
  function fmt(n){
    const raw = (n % (10**DIGITS)).toString().padStart(DIGITS, "0");
    return raw.slice(0,4) + " " + raw.slice(4);
  }

  async function gen(){
    const statusEl = $("status");
    try{
      const key = hexToBytes($("secret").value);
      const ctr = Math.floor(Date.now()/1000 / PERIOD);
      const mac = await hmacSha1(key, counterBytes(ctr));
      $("code").textContent = fmt(truncate(mac));

      if (statusEl){
        statusEl.textContent = "";
        statusEl.classList.remove("err","ok");
      }
    }catch(e){
      $("code").textContent = "--------";
      if (!statusEl) return;

      let msg;
      if (e.message === "ERR_EMPTY_KEY") msg = t("enterKeyError");
      else if (e.message === "ERR_INVALID_KEY") msg = t("invalidKey");
      else msg = e.message;

      statusEl.textContent = msg;
      statusEl.classList.add("err");
      statusEl.classList.remove("ok");
    }
  }

  function tick(){
    const s   = Math.floor(Date.now()/1000);
    const rem = PERIOD - (s % PERIOD);
    $("remain").textContent = `${rem}s`;
    $("bar").style.width    = ((PERIOD - rem) / PERIOD * 100) + "%";
  }

  let last = -1;
  setInterval(() => {
    tick();
    const s = Math.floor(Date.now()/1000);
    if (s !== last){
      last = s;
      gen();
    }
  }, 150);

  $("secret").addEventListener("input", gen);

  $("copy").addEventListener("click", async () => {
    const v = $("code").textContent;
    const statusEl = $("status");
    if (v.includes("-")) return;

    try{
      await navigator.clipboard.writeText(v.replace(/\s/g,""));
      if (statusEl){
        statusEl.textContent = t("copied");
        statusEl.classList.remove("err");
        statusEl.classList.add("ok");
      }
    }catch{
      if (statusEl){
        statusEl.textContent = t("copyBlocked");
        statusEl.classList.remove("ok");
        statusEl.classList.add("err");
      }
    }
  });

  $("clear").addEventListener("click", () => {
    $("secret").value = "";
    $("code").textContent = "--------";
    const statusEl = $("status");
    if (statusEl){
      statusEl.textContent = "";
      statusEl.classList.remove("err","ok");
    }
  });

  // init prefill
  const urlKey = getKeyFromURL();
  if (urlKey) $("secret").value = urlKey;

  tick();
  gen();
</script>
</body>
</html>
