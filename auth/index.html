<!doctype html>
<html lang="en" data-theme="dark">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Authenticator</title>
<link rel="icon" href="/assets/logo.png" />
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Titillium+Web:wght@400;600;700&display=swap">

<style>
  :root{
    --bg:#05060b;
    --card:rgba(15,18,26,.58);
    --border:rgba(160,190,255,.16);
    --border2:rgba(255,255,255,.08);
    --text:#e6f0ff;
    --muted:#8fa0bf;
    --accent:#29b6ff;
    --shadow: 0 22px 70px rgba(0,0,0,.58);
  }

  html,body{height:100%}
  body{
    margin:0;
    font-family:"Titillium Web",system-ui,-apple-system,Segoe UI,Roboto,Arial;
    color:var(--text);
    background: var(--bg);
    overflow-x:hidden;
  }

  body::before{
    content:"";
    position:fixed;
    inset:-20%;
    pointer-events:none;
    background:
      radial-gradient(900px 520px at 50% 28%, rgba(255,255,255,.10), transparent 60%),
      radial-gradient(1200px 700px at 12% 12%, rgba(41,182,255,.22), transparent 55%),
      radial-gradient(1200px 700px at 88% 18%, rgba(255,79,216,.13), transparent 58%),
      radial-gradient(900px 600px at 50% 85%, rgba(41,182,255,.10), transparent 62%),
      linear-gradient(to bottom, rgba(0,0,0,.55), rgba(0,0,0,.75));
    opacity:1;
  }
  body::after{
    content:"";
    position:fixed;
    inset:0;
    pointer-events:none;
    background:
      radial-gradient(circle at 50% 30%, transparent 0 55%, rgba(0,0,0,.70) 100%),
      repeating-linear-gradient(
        to bottom,
        rgba(255,255,255,.028),
        rgba(255,255,255,.028) 1px,
        transparent 1px,
        transparent 9px
      );
    opacity:.14;
    mix-blend-mode:overlay;
  }

  .wrap{
    position:relative;
    z-index:1;
    width:min(980px, 92vw);
    margin:0 auto;
    padding:18px 0 60px;
    min-height:100%;
    display:flex;
    flex-direction:column;
    gap:18px;
  }

  /* top nav (same system as homepage) */
  .top{
    display:flex;
    align-items:center;
    justify-content:center;
    padding-top:10px;
  }
  .nav{
    display:flex;
    align-items:center;
    gap:10px;
    padding:10px 12px;
    border-radius:999px;
    background:rgba(12,14,20,.46);
    border:1px solid var(--border2);
    box-shadow:0 10px 30px rgba(0,0,0,.45), 0 0 0 1px rgba(255,255,255,.05) inset;
    backdrop-filter: blur(12px);
    width:min(920px, 92vw);
    justify-content:space-between;
  }

  .left{
    display:flex; align-items:center; gap:10px;
  }
  .brand{
    display:flex; align-items:center; gap:10px;
    padding:6px 10px;
    border-radius:999px;
    border:1px solid rgba(255,255,255,.06);
    background:rgba(0,0,0,.12);
  }
  .brand img{
    width:28px;height:28px;border-radius:10px;
    box-shadow:0 10px 25px rgba(0,0,0,.40);
  }
  .brand .txt{
    font-weight:900;
    letter-spacing:.06em;
    text-transform:uppercase;
    font-size:12px;
    white-space:nowrap;
    opacity:.95;
  }

  .right{
    display:flex; align-items:center; gap:10px;
  }

  .pill{
    height:34px;
    padding:0 14px;
    border-radius:999px;
    border:1px solid var(--border);
    background:rgba(0,0,0,.16);
    color:var(--text);
    font-size:13px;
    font-weight:800;
    display:inline-flex;
    align-items:center;
    justify-content:center;
    cursor:pointer;
    text-decoration:none;
    user-select:none;
    box-shadow:0 8px 20px rgba(0,0,0,.40), 0 0 0 1px rgba(255,255,255,.05) inset;
    backdrop-filter: blur(12px);
    transition: transform .15s ease, box-shadow .15s ease, background .15s ease;
  }
  .pill:hover{
    transform:translateY(-1px);
    background:rgba(0,0,0,.22);
    box-shadow:0 12px 26px rgba(0,0,0,.58), 0 0 18px rgba(41,182,255,.12);
  }

  .lang-select{
    appearance:none;
    -moz-appearance:none;
    -webkit-appearance:none;
    border:none;
    background:transparent;
    padding:0 18px;
    text-align:center;
    cursor:pointer;
  }
  .lang-select option{ background:#050b16; color:#e8eefc; }

  /* main card */
  .card{
    margin: 6px auto 0;
    width:min(720px, 92vw);
    border-radius: 28px;
    background: linear-gradient(180deg, rgba(15,18,26,.58), rgba(10,12,18,.38));
    border: 1px solid var(--border2);
    box-shadow: var(--shadow), 0 0 0 1px rgba(255,255,255,.04) inset;
    backdrop-filter: blur(14px);
    overflow:hidden;
    position:relative;
    padding:32px 26px 24px;
  }

  .card::before{
    content:"";
    position:absolute;
    inset:-40%;
    background:linear-gradient(90deg, transparent, rgba(41,182,255,.10), transparent);
    transform: rotate(10deg) translateX(-30%);
    animation:sweep 8.5s linear infinite;
    opacity:.55;
    pointer-events:none;
  }
  @keyframes sweep{
    0%{ transform: rotate(10deg) translateX(-35%); opacity:0; }
    12%{ opacity:.55; }
    70%{ opacity:.20; }
    100%{ transform: rotate(10deg) translateX(35%); opacity:0; }
  }

  .title{
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:12px;
    margin-bottom:14px;
    position:relative;
    z-index:1;
  }
  .title h1{
    margin:0;
    font-size:18px;
    letter-spacing:.04em;
    font-weight:900;
  }
  .subtitle{
    margin:0;
    color:var(--muted);
    font-size:13px;
    line-height:1.6;
    position:relative;
    z-index:1;
  }

  .code{
    text-align:center;
    font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
    font-size:72px;
    font-weight:900;
    letter-spacing:6px;
    margin:26px 0 12px;
    position:relative;
    z-index:1;
  }
  .hint{
    text-align:center;
    font-size:13px;
    color:var(--muted);
    margin-bottom:14px;
    position:relative;
    z-index:1;
  }

  .barwrap{
    height:12px;
    background:rgba(255,255,255,.08);
    border-radius:999px;
    overflow:hidden;
    position:relative;
    z-index:1;
  }
  .bar{
    height:100%;
    width:0%;
    background:var(--accent);
    background-image:linear-gradient(90deg,
      rgba(255,255,255,.35),
      rgba(255,255,255,.92),
      rgba(255,255,255,.35));
    background-size:200% 100%;
    animation:stripe 1.3s linear infinite;
    transition:width .15s linear;
  }
  @keyframes stripe{
    0%{background-position:0% 0}
    100%{background-position:200% 0}
  }

  .field-label{
    margin-top:20px;
    font-size:14px;
    color:rgba(230,240,255,.92);
    font-weight:800;
    position:relative;
    z-index:1;
  }
  input{
    width:100%;
    box-sizing:border-box;
    margin-top:10px;
    padding:13px 14px;
    border-radius:16px;
    border:1px solid rgba(160,190,255,.18);
    background:rgba(0,0,0,.16);
    color:var(--text);
    font-family:ui-monospace,monospace;
    outline:none;
    box-shadow:0 12px 30px rgba(0,0,0,.25), 0 0 0 1px rgba(255,255,255,.04) inset;
    backdrop-filter: blur(14px);
    position:relative;
    z-index:1;
  }
  input::placeholder{ color:rgba(143,160,191,.72); }

  .row{
    display:flex;
    gap:12px;
    margin-top:18px;
    position:relative;
    z-index:1;
  }
  button{
    flex:1 1 auto;
    height:46px;
    padding:0 14px;
    border-radius:16px;
    border:1px solid rgba(160,190,255,.18);
    background:rgba(0,0,0,.16);
    color:var(--text);
    cursor:pointer;
    font-weight:900;
    font-family:"Titillium Web",system-ui,-apple-system,Segoe UI,Roboto,Arial;
    box-shadow:0 16px 40px rgba(0,0,0,.30), 0 0 0 1px rgba(255,255,255,.04) inset;
    backdrop-filter: blur(14px);
    transition: transform .15s ease, box-shadow .15s ease, background .15s ease;
  }
  button:hover{
    transform:translateY(-1px);
    background:rgba(0,0,0,.22);
    box-shadow:0 18px 52px rgba(0,0,0,.50), 0 0 16px rgba(41,182,255,.12);
  }
  button.primary{
    border-color: transparent;
    background: linear-gradient(135deg, rgba(41,182,255,.95), rgba(41,182,255,.70));
    color:#071018;
  }

  .status{
    margin-top:10px;
    text-align:center;
    font-size:12px;
    min-height:18px;
    position:relative;
    z-index:1;
  }
  .status.ok{color:#4cd18c;}
  .status.err{color:#ff6b6b;}

  .footer{
    margin-top:auto;
    text-align:center;
    color:rgba(143,160,191,.78);
    font-size:12px;
    opacity:.9;
    user-select:none;
    padding-top:10px;
  }

  @media (max-width:520px){
    .nav{
      border-radius:20px;
      width:92vw;
      padding:10px 10px;
      gap:8px;
      flex-wrap:wrap;
    }
    .brand .txt{ font-size:11px; }
    .card{ padding:24px 16px 18px; border-radius:24px; }
    .code{ font-size:clamp(40px, 12vw, 52px); letter-spacing:4px; }
    .row{ flex-direction:column; }
  }

  html[dir="rtl"] .left{ flex-direction:row-reverse; }
</style>
</head>

<body>
  <div class="wrap">
    <div class="top">
      <div class="nav">
        <div class="left">
          <a class="pill" href="/" id="homeBtn" title="Home">üè†</a>
          <div class="brand">
            <img src="/assets/logo.png" alt="Logo">
            <div class="txt" id="brandText">ROSHINE ACCOUNT STORE.</div>
          </div>
        </div>

        <div class="right">
          <select id="langSelect" class="pill lang-select" title="Language">
            <option value="en">EN</option>
            <option value="zh">‰∏≠Êñá</option>
            <option value="fr">FR</option>
            <option value="de">DE</option>
            <option value="ar">ÿßŸÑÿπÿ±ÿ®Ÿäÿ©</option>
          </select>
        </div>
      </div>
    </div>

    <div class="card">
      <div class="title">
        <h1 id="titleText">Authenticator</h1>
      </div>
      <p class="subtitle" id="subtitleText">Paste your Private Key to generate the 8-digit code.</p>

      <div class="code" id="code">--------</div>
      <div class="hint" id="remain"></div>
      <div class="barwrap"><div class="bar" id="bar"></div></div>

      <div class="field-label" id="secretLabel">Private Key</div>
      <input id="secret" placeholder="Private Key" autocomplete="off" spellcheck="false" />

      <div class="row">
        <button class="primary" id="copy">Copy Code</button>
        <button id="clear">Clear</button>
      </div>

      <div class="status" id="status"></div>
    </div>

    <div class="footer" id="footer"></div>
  </div>

<script>
  // ===== constants =====
  const DIGITS = 8;
  const PERIOD = 30;
  const LANG_KEY  = "locale-choice";
  const $ = id => document.getElementById(id);

  // ===== i18n: EN / ‰∏≠Êñá / FR / DE / AR only =====
  const i18n = {
    en: {
      brand: "ROSHINE ACCOUNT STORE.",
      homeTitle: "Home",
      title: "Authenticator",
      subtitle: "Paste your Private Key to generate the 8-digit code.",
      secretLabel: "Private Key",
      placeholder: "Private Key",
      copy: "Copy Code",
      clear: "Clear",
      copied: "Copied",
      copyBlocked: "Copy blocked",
      enterKeyError: "Enter your Private Key",
      invalidKey: "Invalid Private Key",
      footer: "¬© {year} roshine account store. All rights reserved."
    },
    zh: {
      brand: "ROSHINE ACCOUNT STORE.",
      homeTitle: "ËøîÂõû‰∏ªÈ°µ",
      title: "ÂÆâÂÖ®‰ª§",
      subtitle: "Á≤òË¥¥ Private Key ÁîüÊàê 8 ‰ΩçÈ™åËØÅÁ†Å„ÄÇ",
      secretLabel: "ÂÆâÂÖ®‰ª§ÁßòÈí•",
      placeholder: "ÂÆâÂÖ®‰ª§ÁßòÈí•",
      copy: "Â§çÂà∂È™åËØÅÁ†Å",
      clear: "Ê∏ÖÁ©∫",
      copied: "Â∑≤Â§çÂà∂",
      copyBlocked: "ÊµèËßàÂô®Á¶ÅÊ≠¢Â§çÂà∂",
      enterKeyError: "ËØ∑ËæìÂÖ•ÂÆâÂÖ®‰ª§ÁßòÈí•",
      invalidKey: "Êó†ÊïàÁöÑÂÆâÂÖ®‰ª§ÁßòÈí•",
      footer: "¬© {year} roshine account store. ‰øùÁïôÊâÄÊúâÊùÉÂà©„ÄÇ"
    },
    fr: {
      brand: "ROSHINE ACCOUNT STORE.",
      homeTitle: "Accueil",
      title: "Jeton",
      subtitle: "Collez votre cl√© priv√©e pour g√©n√©rer le code √† 8 chiffres.",
      secretLabel: "Cl√© priv√©e",
      placeholder: "Cl√© priv√©e",
      copy: "Copier",
      clear: "Effacer",
      copied: "Copi√©",
      copyBlocked: "Copie bloqu√©e",
      enterKeyError: "Entrez la cl√© priv√©e",
      invalidKey: "Cl√© priv√©e invalide",
      footer: "¬© {year} roshine account store. Tous droits r√©serv√©s."
    },
    de: {
      brand: "ROSHINE ACCOUNT STORE.",
      homeTitle: "Startseite",
      title: "Token",
      subtitle: "Private Key einf√ºgen, um den 8-stelligen Code zu erzeugen.",
      secretLabel: "Private Key",
      placeholder: "Private Key",
      copy: "Code kopieren",
      clear: "L√∂schen",
      copied: "Kopiert",
      copyBlocked: "Kopieren blockiert",
      enterKeyError: "Private Key eingeben",
      invalidKey: "Ung√ºltiger Private Key",
      footer: "¬© {year} roshine account store. Alle Rechte vorbehalten."
    },
    ar: {
      brand: "ROSHINE ACCOUNT STORE.",
      homeTitle: "ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ©",
      title: "ÿßŸÑŸÖŸèÿµÿØŸëŸêŸÇ",
      subtitle: "ÿßŸÑÿµŸÇ Private Key ŸÑÿ•ŸÜÿ¥ÿßÿ° ÿ±ŸÖÿ≤ ŸÖŸÉŸàŸëŸÜ ŸÖŸÜ 8 ÿ£ÿ±ŸÇÿßŸÖ.",
      secretLabel: "Private Key",
      placeholder: "Private Key",
      copy: "ŸÜÿ≥ÿÆ ÿßŸÑÿ±ŸÖÿ≤",
      clear: "ŸÖÿ≥ÿ≠",
      copied: "ÿ™ŸÖ ÿßŸÑŸÜÿ≥ÿÆ",
      copyBlocked: "ÿ™ŸÖ ÿ≠ÿ∏ÿ± ÿßŸÑŸÜÿ≥ÿÆ",
      enterKeyError: "ÿ£ÿØÿÆŸÑ Private Key",
      invalidKey: "Private Key ÿ∫Ÿäÿ± ÿµÿßŸÑÿ≠",
      footer: "¬© {year} roshine account store. ÿ¨ŸÖŸäÿπ ÿßŸÑÿ≠ŸÇŸàŸÇ ŸÖÿ≠ŸÅŸàÿ∏ÿ©."
    }
  };

  function detectLang(){
    const saved = localStorage.getItem(LANG_KEY);
    if (saved && i18n[saved]) return saved;

    const nav = (navigator.language || "en").toLowerCase();
    if (nav.startsWith("zh")) return "zh";
    if (nav.startsWith("fr")) return "fr";
    if (nav.startsWith("de")) return "de";
    if (nav.startsWith("ar")) return "ar";
    return "en";
  }

  let currentLang = "en";
  const t = key => (i18n[currentLang] && i18n[currentLang][key]) || i18n.en[key] || key;

  function applyLang(lang){
    if (!i18n[lang]) lang = "en";
    currentLang = lang;

    document.documentElement.lang = lang;
    document.documentElement.dir  = (lang === "ar" ? "rtl" : "ltr");

    const sel = $("langSelect");
    if (sel) sel.value = lang;

    $("brandText").textContent = t("brand");
    $("homeBtn").title = t("homeTitle");

    $("titleText").textContent = t("title");
    $("subtitleText").textContent = t("subtitle");
    $("secretLabel").textContent = t("secretLabel");
    $("secret").placeholder = t("placeholder");
    $("copy").textContent = t("copy");
    $("clear").textContent = t("clear");

    $("footer").textContent = t("footer").replace("{year}", new Date().getFullYear());
  }

  applyLang(detectLang());

  $("langSelect").addEventListener("change", e => {
    const lang = e.target.value;
    localStorage.setItem(LANG_KEY, lang);
    applyLang(lang);
  });

  // ===== URL key support (?key= or /hex) =====
  function getKeyFromURL(){
    const u = new URL(location.href);
    const paramKey = u.searchParams.get("key");
    if (paramKey && /^[0-9a-fA-F]+$/.test(paramKey)) return paramKey;

    const parts = u.pathname.split("/").filter(Boolean);
    if (parts.length){
      const last = parts[parts.length - 1];
      if (/^[0-9a-fA-F]+$/.test(last)) return last;
    }
    return null;
  }

  // ===== TOTP =====
  function hexToBytes(s){
    s = s.trim().replace(/^0x/i,"").replace(/[^0-9a-f]/ig,"");
    if (!s) throw new Error("ERR_EMPTY_KEY");
    if (s.length % 2) throw new Error("ERR_INVALID_KEY");
    return Uint8Array.from(s.match(/../g).map(x => parseInt(x,16)));
  }
  function counterBytes(c){
    const b = new Uint8Array(8); let x = BigInt(c);
    for (let i = 7; i >= 0; i--){
      b[i] = Number(x & 0xffn);
      x >>= 8n;
    }
    return b;
  }
  async function hmacSha1(key,msg){
    const k = await crypto.subtle.importKey(
      "raw", key, {name:"HMAC", hash:"SHA-1"}, false, ["sign"]
    );
    return new Uint8Array(await crypto.subtle.sign("HMAC",k,msg));
  }
  function truncate(mac){
    const o = mac[mac.length - 1] & 0x0f;
    return (((mac[o]   & 0x7f) << 24) |
            ((mac[o+1] & 0xff) << 16) |
            ((mac[o+2] & 0xff) << 8)  |
            ( mac[o+3] & 0xff)) >>> 0;
  }
  function fmt(n){
    const raw = (n % (10**DIGITS)).toString().padStart(DIGITS, "0");
    return raw.slice(0,4) + " " + raw.slice(4);
  }

  async function gen(){
    const statusEl = $("status");
    try{
      const key = hexToBytes($("secret").value);
      const ctr = Math.floor(Date.now()/1000 / PERIOD);
      const mac = await hmacSha1(key, counterBytes(ctr));
      $("code").textContent = fmt(truncate(mac));
      if (statusEl){
        statusEl.textContent = "";
        statusEl.classList.remove("err","ok");
      }
    }catch(e){
      $("code").textContent = "--------";
      if (!statusEl) return;
      let msg;
      if (e.message === "ERR_EMPTY_KEY") msg = t("enterKeyError");
      else if (e.message === "ERR_INVALID_KEY") msg = t("invalidKey");
      else msg = e.message;
      statusEl.textContent = msg;
      statusEl.classList.add("err");
      statusEl.classList.remove("ok");
    }
  }

  function tick(){
    const s   = Math.floor(Date.now()/1000);
    const rem = PERIOD - (s % PERIOD);
    $("remain").textContent = `${rem}s`;
    $("bar").style.width    = ((PERIOD - rem) / PERIOD * 100) + "%";
  }

  let last = -1;
  setInterval(() => {
    tick();
    const s = Math.floor(Date.now()/1000);
    if (s !== last){
      last = s;
      gen();
    }
  }, 150);

  $("secret").addEventListener("input", gen);

  $("copy").addEventListener("click", async () => {
    const v = $("code").textContent;
    const statusEl = $("status");
    if (v.includes("-")) return;
    try{
      await navigator.clipboard.writeText(v.replace(/\s/g,""));
      if (statusEl){
        statusEl.textContent = t("copied");
        statusEl.classList.remove("err");
        statusEl.classList.add("ok");
      }
    }catch{
      if (statusEl){
        statusEl.textContent = t("copyBlocked");
        statusEl.classList.remove("ok");
        statusEl.classList.add("err");
      }
    }
  });

  $("clear").addEventListener("click", () => {
    $("secret").value = "";
    $("code").textContent = "--------";
    const statusEl = $("status");
    if (statusEl){
      statusEl.textContent = "";
      statusEl.classList.remove("err","ok");
    }
  });

  // init key from url
  const urlKey = getKeyFromURL();
  if (urlKey) $("secret").value = urlKey;

  tick();
  gen();
</script>
</body>
</html>
