<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Redirect…</title>
</head>
<body>
<script>
(function () {
  var path = location.pathname || "/";
  var parts = path.split("/").filter(Boolean);
  var last = parts.length ? parts[parts.length - 1] : "";

  // 检查最后一段是不是纯 hex
  if (/^[0-9a-fA-F]+$/.test(last)) {
    // 计算当前仓库的“根路径”，保证在单独 repo 或自定义域下都正确
    var base = path.replace(/\/[^\/]*$/, "/"); // 去掉最后一段
    if (!base.endsWith("/")) base += "/";
    location.replace(base + "?key=" + encodeURIComponent(last));
  } else {
    // 普通 404，直接回根目录
    var base2 = path.replace(/\/[^\/]*$/, "/");
    if (!base2.endsWith("/")) base2 += "/";
    location.replace(base2);
  }
})();
</script>
</body>
</html>
